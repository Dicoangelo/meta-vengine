<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Claude Code Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
      min-height: 100vh;
      color: #fff;
      padding: 2rem;
    }
    .container { max-width: 1400px; margin: 0 auto; }

    header {
      text-align: center;
      margin-bottom: 2rem;
      padding: 2rem;
      background: rgba(255,255,255,0.05);
      border-radius: 20px;
      backdrop-filter: blur(10px);
    }
    header h1 {
      font-size: 2.5rem;
      background: linear-gradient(90deg, #e94560, #ff6b6b, #feca57);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 0.5rem;
    }
    header p { color: #888; font-size: 1.1rem; }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }
    .stat-card {
      background: rgba(255,255,255,0.08);
      border-radius: 16px;
      padding: 1.5rem;
      text-align: center;
      border: 1px solid rgba(255,255,255,0.1);
      transition: transform 0.3s, box-shadow 0.3s;
    }
    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 40px rgba(233, 69, 96, 0.2);
    }
    .stat-card .value {
      font-size: 2.5rem;
      font-weight: 700;
      background: linear-gradient(90deg, #e94560, #ff6b6b);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .stat-card .label {
      color: #888;
      font-size: 0.9rem;
      margin-top: 0.5rem;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    /* Co-Evolution Section */
    .coevo-section {
      margin-top: 2rem;
      padding-top: 2rem;
      border-top: 2px solid rgba(0, 217, 255, 0.3);
    }
    .section-title {
      text-align: center;
      font-size: 1.8rem;
      margin-bottom: 1.5rem;
      background: linear-gradient(90deg, #00d9ff, #9945ff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .coevo-card {
      border-color: rgba(0, 217, 255, 0.3);
    }
    .coevo-card:hover {
      box-shadow: 0 10px 40px rgba(0, 217, 255, 0.2);
    }
    .coevo-card .value {
      background: linear-gradient(90deg, #00d9ff, #9945ff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .coevo-status {
      padding: 1rem;
    }
    .status-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem 0;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    .status-item:last-child {
      border-bottom: none;
    }
    .status-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: #666;
    }
    .status-dot.active {
      background: #00d9ff;
      box-shadow: 0 0 10px #00d9ff;
    }
    .status-dot.warning {
      background: #feca57;
      box-shadow: 0 0 10px #feca57;
    }

    .charts-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }
    .chart-card {
      background: rgba(255,255,255,0.08);
      border-radius: 16px;
      padding: 1.5rem;
      border: 1px solid rgba(255,255,255,0.1);
    }
    .chart-card h3 {
      margin-bottom: 1rem;
      color: #fff;
      font-size: 1.2rem;
    }
    .chart-container {
      position: relative;
      height: 300px;
    }

    .hour-heatmap {
      display: grid;
      grid-template-columns: repeat(24, 1fr);
      gap: 4px;
      margin-top: 1rem;
    }
    .hour-cell {
      aspect-ratio: 1;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
      color: #fff;
      position: relative;
    }
    .hour-cell::after {
      content: attr(data-hour);
      position: absolute;
      bottom: -18px;
      font-size: 0.6rem;
      color: #666;
    }

    .token-breakdown {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
      justify-content: center;
      margin-top: 1rem;
    }
    .token-item {
      background: rgba(255,255,255,0.05);
      padding: 1rem 1.5rem;
      border-radius: 12px;
      text-align: center;
    }
    .token-item .value { font-size: 1.5rem; font-weight: 600; }
    .token-item .label { font-size: 0.8rem; color: #888; }

    .model-badge {
      display: inline-block;
      background: linear-gradient(90deg, #e94560, #ff6b6b);
      padding: 0.5rem 1rem;
      border-radius: 20px;
      font-size: 0.9rem;
      font-weight: 600;
      margin-top: 1rem;
    }

    #loadingOverlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: #1a1a2e;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      transition: opacity 0.5s;
    }
    #loadingOverlay.hidden { opacity: 0; pointer-events: none; }
    .loader {
      width: 50px;
      height: 50px;
      border: 3px solid rgba(255,255,255,0.1);
      border-top-color: #e94560;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    .refresh-btn {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      background: linear-gradient(90deg, #e94560, #ff6b6b);
      border: none;
      padding: 1rem 1.5rem;
      border-radius: 50px;
      color: #fff;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 4px 20px rgba(233, 69, 96, 0.4);
      transition: transform 0.3s;
    }
    .refresh-btn:hover { transform: scale(1.05); }
  </style>
</head>
<body>
  <div id="loadingOverlay"><div class="loader"></div></div>

  <div class="container">
    <header>
      <h1>Claude Code Dashboard</h1>
      <p id="dateRange">Loading...</p>
      <div class="model-badge" id="modelBadge">Opus 4.5</div>
    </header>

    <div class="stats-grid">
      <div class="stat-card">
        <div class="value" id="totalSessions">-</div>
        <div class="label">Total Sessions</div>
      </div>
      <div class="stat-card">
        <div class="value" id="totalMessages">-</div>
        <div class="label">Total Messages</div>
      </div>
      <div class="stat-card">
        <div class="value" id="totalTools">-</div>
        <div class="label">Tool Calls</div>
      </div>
      <div class="stat-card">
        <div class="value" id="longestSession">-</div>
        <div class="label">Longest Session</div>
      </div>
      <div class="stat-card">
        <div class="value" id="avgPerDay">-</div>
        <div class="label">Avg Msgs/Day</div>
      </div>
      <div class="stat-card">
        <div class="value" id="totalTokens">-</div>
        <div class="label">Total Tokens</div>
      </div>
    </div>

    <div class="charts-grid">
      <div class="chart-card">
        <h3>Daily Messages</h3>
        <div class="chart-container">
          <canvas id="messagesChart"></canvas>
        </div>
      </div>
      <div class="chart-card">
        <h3>Daily Tool Calls</h3>
        <div class="chart-container">
          <canvas id="toolsChart"></canvas>
        </div>
      </div>
      <div class="chart-card">
        <h3>Token Usage by Day</h3>
        <div class="chart-container">
          <canvas id="tokensChart"></canvas>
        </div>
      </div>
      <div class="chart-card">
        <h3>Sessions by Hour</h3>
        <div class="chart-container">
          <canvas id="hourChart"></canvas>
        </div>
      </div>
    </div>

    <div class="chart-card">
      <h3>Token Breakdown</h3>
      <div class="token-breakdown" id="tokenBreakdown"></div>
    </div>

    <!-- CO-EVOLUTION SECTION -->
    <div class="coevo-section">
      <h2 class="section-title">⚙️ Meta-Vengine · Co-Evolution</h2>
      <div class="stats-grid">
        <div class="stat-card coevo-card">
          <div class="value" id="cacheEfficiency">-</div>
          <div class="label">Cache Efficiency</div>
        </div>
        <div class="stat-card coevo-card">
          <div class="value" id="dqScore">-</div>
          <div class="label">DQ Score</div>
        </div>
        <div class="stat-card coevo-card">
          <div class="value" id="dominantPattern">-</div>
          <div class="label">Dominant Pattern</div>
        </div>
        <div class="stat-card coevo-card">
          <div class="value" id="modsApplied">-</div>
          <div class="label">Mods Applied</div>
        </div>
      </div>
      <div class="charts-grid">
        <div class="chart-card">
          <h3>Pattern Distribution</h3>
          <div class="chart-container">
            <canvas id="patternChart"></canvas>
          </div>
        </div>
        <div class="chart-card">
          <h3>Evolution Status</h3>
          <div class="coevo-status" id="coevoStatus">
            <div class="status-item">
              <span class="status-dot active"></span>
              <span>Auto-Analyze: <strong id="autoAnalyze">9 AM, 6 PM</strong></span>
            </div>
            <div class="status-item">
              <span class="status-dot" id="autoApplyDot"></span>
              <span>Auto-Apply: <strong id="autoApply">OFF</strong></span>
            </div>
            <div class="status-item">
              <span class="status-dot active"></span>
              <span>Min Confidence: <strong id="minConfidence">0.7</strong></span>
            </div>
            <div class="status-item">
              <span class="status-dot active"></span>
              <span>Flywheel: <strong>Spinning</strong></span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <button class="refresh-btn" onclick="location.reload()">Refresh</button>

  <script>
    // Stats data will be injected here by the generator script
    const STATS_DATA = {"version": 1, "lastComputedDate": "2026-01-17", "dailyActivity": [{"date": "2026-01-09", "messageCount": 2576, "sessionCount": 9, "toolCallCount": 683}, {"date": "2026-01-10", "messageCount": 499, "sessionCount": 4, "toolCallCount": 129}, {"date": "2026-01-11", "messageCount": 305, "sessionCount": 3, "toolCallCount": 77}, {"date": "2026-01-12", "messageCount": 1447, "sessionCount": 7, "toolCallCount": 407}, {"date": "2026-01-13", "messageCount": 4044, "sessionCount": 10, "toolCallCount": 1067}, {"date": "2026-01-14", "messageCount": 3430, "sessionCount": 22, "toolCallCount": 1012}, {"date": "2026-01-15", "messageCount": 2099, "sessionCount": 17, "toolCallCount": 572}, {"date": "2026-01-16", "messageCount": 2151, "sessionCount": 10, "toolCallCount": 440}, {"date": "2026-01-17", "messageCount": 10970, "sessionCount": 22, "toolCallCount": 1397}], "dailyModelTokens": [{"date": "2026-01-09", "tokensByModel": {"claude-opus-4-5-20251101": 444367}}, {"date": "2026-01-10", "tokensByModel": {"claude-opus-4-5-20251101": 83828}}, {"date": "2026-01-11", "tokensByModel": {"claude-opus-4-5-20251101": 32531}}, {"date": "2026-01-12", "tokensByModel": {"claude-opus-4-5-20251101": 161378}}, {"date": "2026-01-13", "tokensByModel": {"claude-opus-4-5-20251101": 626221}}, {"date": "2026-01-14", "tokensByModel": {"claude-opus-4-5-20251101": 854049}}, {"date": "2026-01-15", "tokensByModel": {"claude-opus-4-5-20251101": 300452}}, {"date": "2026-01-16", "tokensByModel": {"claude-opus-4-5-20251101": 325365}}, {"date": "2026-01-17", "tokensByModel": {"claude-opus-4-5-20251101": 238967, "claude-sonnet-4-5-20250929": 507}}], "modelUsage": {"claude-opus-4-5-20251101": {"inputTokens": 1155171, "outputTokens": 1911987, "cacheReadInputTokens": 1057054033, "cacheCreationInputTokens": 65909248, "webSearchRequests": 0, "costUSD": 0, "contextWindow": 0, "maxOutputTokens": 0}, "claude-sonnet-4-5-20250929": {"inputTokens": 392, "outputTokens": 115, "cacheReadInputTokens": 1161640, "cacheCreationInputTokens": 58363, "webSearchRequests": 0, "costUSD": 0, "contextWindow": 0, "maxOutputTokens": 0}}, "totalSessions": 104, "totalMessages": 27521, "longestSession": {"sessionId": "fa889f9f-a553-4354-a96e-785e47de81cd", "duration": 85456717, "messageCount": 550, "timestamp": "2026-01-14T01:36:16.129Z"}, "firstSessionDate": "2026-01-09T10:57:31.210Z", "hourCounts": {"0": 1, "2": 1, "3": 1, "5": 1, "6": 4, "7": 4, "8": 5, "9": 2, "10": 7, "11": 7, "12": 3, "13": 3, "14": 8, "15": 18, "16": 8, "17": 6, "18": 2, "19": 4, "20": 8, "21": 3, "22": 6, "23": 2}};
    const COEVO_DATA = {"cacheEfficiency": 94.03, "dqScore": 0.839, "dominantPattern": "debugging", "modsApplied": 4, "autoApply": false, "minConfidence": 0.7, "patterns": [{"id": "debugging", "name": "Debugging Session", "icon": "\ud83d\udd0d", "confidence": 1, "totalMatches": 7, "matchingEvents": [{"timestamp": 1768589317206, "text": "fix the error in my code", "matches": 2}, {"timestamp": 1768589317276, "text": "debug this issue", "matches": 3}, {"timestamp": 1768589317337, "text": "why is this not working", "matches": 2}], "suggestions": [{"type": "skill", "value": "/debug", "label": "Run systematic debug", "desc": "Comprehensive debugging workflow"}, {"type": "model", "value": "opus", "label": "Switch to Opus", "desc": "Better for complex analysis"}, {"type": "memory", "value": "error patterns", "label": "Recall error patterns", "desc": "Load related debugging memories"}, {"type": "command", "value": "git diff", "label": "View recent changes", "desc": "Check what changed recently"}]}]};

    function formatNumber(n) {
      if (n >= 1000000000) return (n / 1000000000).toFixed(1) + 'B';
      if (n >= 1000000) return (n / 1000000).toFixed(1) + 'M';
      if (n >= 1000) return (n / 1000).toFixed(1) + 'K';
      return n.toString();
    }

    function init() {
      const data = STATS_DATA;

      // Header
      const firstDate = data.firstSessionDate.split('T')[0];
      const days = data.dailyActivity.length;
      document.getElementById('dateRange').textContent = `${firstDate} → Today (${days} days)`;

      // Stats cards
      document.getElementById('totalSessions').textContent = data.totalSessions;
      document.getElementById('totalMessages').textContent = formatNumber(data.totalMessages);

      const totalTools = data.dailyActivity.reduce((sum, d) => sum + d.toolCallCount, 0);
      document.getElementById('totalTools').textContent = formatNumber(totalTools);

      document.getElementById('longestSession').textContent = data.longestSession.messageCount + ' msgs';

      const avgPerDay = Math.round(data.totalMessages / days);
      document.getElementById('avgPerDay').textContent = formatNumber(avgPerDay);

      // Token totals
      const modelData = Object.values(data.modelUsage)[0] || {};
      const totalTokens = (modelData.inputTokens || 0) + (modelData.outputTokens || 0) +
                          (modelData.cacheReadInputTokens || 0) + (modelData.cacheCreationInputTokens || 0);
      document.getElementById('totalTokens').textContent = formatNumber(totalTokens);

      // Token breakdown
      const tokenBreakdown = document.getElementById('tokenBreakdown');
      const tokenTypes = [
        { label: 'Output', value: modelData.outputTokens || 0, color: '#e94560' },
        { label: 'Input', value: modelData.inputTokens || 0, color: '#ff6b6b' },
        { label: 'Cache Read', value: modelData.cacheReadInputTokens || 0, color: '#feca57' },
        { label: 'Cache Create', value: modelData.cacheCreationInputTokens || 0, color: '#48dbfb' }
      ];
      tokenBreakdown.innerHTML = tokenTypes.map(t => `
        <div class="token-item">
          <div class="value" style="color: ${t.color}">${formatNumber(t.value)}</div>
          <div class="label">${t.label}</div>
        </div>
      `).join('');

      // Chart defaults
      Chart.defaults.color = '#888';
      Chart.defaults.borderColor = 'rgba(255,255,255,0.1)';

      const gradient1 = document.getElementById('messagesChart').getContext('2d').createLinearGradient(0, 0, 0, 300);
      gradient1.addColorStop(0, 'rgba(233, 69, 96, 0.8)');
      gradient1.addColorStop(1, 'rgba(233, 69, 96, 0.1)');

      // Messages chart
      new Chart(document.getElementById('messagesChart'), {
        type: 'bar',
        data: {
          labels: data.dailyActivity.map(d => d.date.slice(5)),
          datasets: [{
            label: 'Messages',
            data: data.dailyActivity.map(d => d.messageCount),
            backgroundColor: gradient1,
            borderColor: '#e94560',
            borderWidth: 2,
            borderRadius: 8
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: { legend: { display: false } },
          scales: { y: { beginAtZero: true } }
        }
      });

      // Tools chart
      const gradient2 = document.getElementById('toolsChart').getContext('2d').createLinearGradient(0, 0, 0, 300);
      gradient2.addColorStop(0, 'rgba(254, 202, 87, 0.8)');
      gradient2.addColorStop(1, 'rgba(254, 202, 87, 0.1)');

      new Chart(document.getElementById('toolsChart'), {
        type: 'bar',
        data: {
          labels: data.dailyActivity.map(d => d.date.slice(5)),
          datasets: [{
            label: 'Tool Calls',
            data: data.dailyActivity.map(d => d.toolCallCount),
            backgroundColor: gradient2,
            borderColor: '#feca57',
            borderWidth: 2,
            borderRadius: 8
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: { legend: { display: false } },
          scales: { y: { beginAtZero: true } }
        }
      });

      // Tokens chart
      new Chart(document.getElementById('tokensChart'), {
        type: 'line',
        data: {
          labels: data.dailyModelTokens.map(d => d.date.slice(5)),
          datasets: [{
            label: 'Tokens',
            data: data.dailyModelTokens.map(d => Object.values(d.tokensByModel)[0] || 0),
            borderColor: '#48dbfb',
            backgroundColor: 'rgba(72, 219, 251, 0.1)',
            fill: true,
            tension: 0.4,
            pointBackgroundColor: '#48dbfb',
            pointRadius: 6
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: { legend: { display: false } },
          scales: { y: { beginAtZero: true } }
        }
      });

      // Hour chart
      const hourData = Array(24).fill(0);
      Object.entries(data.hourCounts || {}).forEach(([h, c]) => hourData[parseInt(h)] = c);

      new Chart(document.getElementById('hourChart'), {
        type: 'bar',
        data: {
          labels: Array.from({length: 24}, (_, i) => i + 'h'),
          datasets: [{
            label: 'Sessions',
            data: hourData,
            backgroundColor: hourData.map(v => `rgba(233, 69, 96, ${0.3 + (v / Math.max(...hourData)) * 0.7})`),
            borderRadius: 4
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: { legend: { display: false } },
          scales: { y: { beginAtZero: true } }
        }
      });

      // CO-EVOLUTION SECTION
      if (COEVO_DATA && typeof COEVO_DATA === 'object') {
        const coevo = COEVO_DATA;

        // Stats cards
        document.getElementById('cacheEfficiency').textContent = coevo.cacheEfficiency + '%';
        document.getElementById('dqScore').textContent = coevo.dqScore?.toFixed(3) || '0.839';
        document.getElementById('dominantPattern').textContent = coevo.dominantPattern || 'none';
        document.getElementById('modsApplied').textContent = coevo.modsApplied || '0';

        // Status items
        document.getElementById('autoApply').textContent = coevo.autoApply ? 'ON' : 'OFF';
        document.getElementById('autoApplyDot').classList.toggle('active', coevo.autoApply);
        document.getElementById('autoApplyDot').classList.toggle('warning', !coevo.autoApply);
        document.getElementById('minConfidence').textContent = coevo.minConfidence || '0.7';

        // Pattern distribution chart
        const patterns = coevo.patterns || [];
        if (patterns.length > 0) {
          new Chart(document.getElementById('patternChart'), {
            type: 'doughnut',
            data: {
              labels: patterns.map(p => p.name || p.id),
              datasets: [{
                data: patterns.map(p => p.confidence || p.totalMatches || 1),
                backgroundColor: ['#00d9ff', '#9945ff', '#ffd700', '#00ff88', '#ff6b6b', '#48dbfb', '#feca57', '#ff9f43'],
                borderWidth: 0
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: {
                  position: 'bottom',
                  labels: { color: '#888', padding: 15 }
                }
              }
            }
          });
        }
      }

      // Hide loader
      document.getElementById('loadingOverlay').classList.add('hidden');
    }

    init();
  </script>
</body>
</html>
